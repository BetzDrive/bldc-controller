#include "fast_math.h"

#include <cmath>
#include "constants.h"

namespace motor_driver {
  namespace math {

    static const LFFlipType sin_periodicity_flips[] = {
      LFFlipType::NONE,
      LFFlipType::HORIZONTAL,
      LFFlipType::VERTICAL,
      LFFlipType::BOTH
    };

    static const LFPeriodicity sin_periodicity = {
      4,
      sin_periodicity_flips
    };

    static const float sin_first_quadrant[] = {0.000000000, 0.001533980, 0.003067957, 0.004601926, 0.006135885, 0.007669829, 0.009203754, 0.010737658, 0.012271538, 0.013805388, 0.015339206, 0.016872987, 0.018406730, 0.019940428, 0.021474080, 0.023007682, 0.024541229, 0.026074717, 0.027608145, 0.029141510, 0.030674802, 0.032208025, 0.033741172, 0.035274237, 0.036807224, 0.038340122, 0.039872929, 0.041405641, 0.042938255, 0.044470772, 0.046003181, 0.047535487, 0.049067676, 0.050599746, 0.052131705, 0.053663537, 0.055195246, 0.056726821, 0.058258265, 0.059789568, 0.061320737, 0.062851757, 0.064382628, 0.065913357, 0.067443915, 0.068974331, 0.070504576, 0.072034657, 0.073564567, 0.075094298, 0.076623864, 0.078153238, 0.079682440, 0.081211448, 0.082740262, 0.084268890, 0.085797310, 0.087325536, 0.088853553, 0.090381362, 0.091908954, 0.093436331, 0.094963498, 0.096490428, 0.098017141, 0.099543616, 0.101069860, 0.102595873, 0.104121633, 0.105647154, 0.107172422, 0.108697444, 0.110222206, 0.111746706, 0.113270953, 0.114794925, 0.116318636, 0.117842063, 0.119365208, 0.120888092, 0.122410670, 0.123932980, 0.125454977, 0.126976699, 0.128498107, 0.130019218, 0.131540030, 0.133060530, 0.134580702, 0.136100575, 0.137620121, 0.139139339, 0.140658244, 0.142176807, 0.143695042, 0.145212919, 0.146730468, 0.148247689, 0.149764523, 0.151281044, 0.152797192, 0.154312983, 0.155828401, 0.157343462, 0.158858150, 0.160372451, 0.161886394, 0.163399950, 0.164913118, 0.166425899, 0.167938292, 0.169450298, 0.170961887, 0.172473088, 0.173983872, 0.175494254, 0.177004218, 0.178513780, 0.180022910, 0.181531608, 0.183039889, 0.184547737, 0.186055139, 0.187562123, 0.189068660, 0.190574765, 0.192080393, 0.193585590, 0.195090324, 0.196594596, 0.198098406, 0.199601755, 0.201104626, 0.202607036, 0.204108968, 0.205610424, 0.207111374, 0.208611846, 0.210111842, 0.211611316, 0.213110313, 0.214608818, 0.216106802, 0.217604265, 0.219101235, 0.220597699, 0.222093612, 0.223589033, 0.225083917, 0.226578265, 0.228072077, 0.229565367, 0.231058121, 0.232550308, 0.234041959, 0.235533059, 0.237023592, 0.238513589, 0.240003020, 0.241491884, 0.242980182, 0.244467899, 0.245955050, 0.247441620, 0.248927608, 0.250413001, 0.251897812, 0.253382057, 0.254865646, 0.256348670, 0.257831097, 0.259312928, 0.260794133, 0.262274712, 0.263754696, 0.265234023, 0.266712755, 0.268190861, 0.269668311, 0.271145165, 0.272621363, 0.274096936, 0.275571793, 0.277046084, 0.278519690, 0.279992640, 0.281464934, 0.282936573, 0.284407556, 0.285877824, 0.287347466, 0.288816392, 0.290284663, 0.291752279, 0.293219179, 0.294685394, 0.296150863, 0.297615707, 0.299079835, 0.300543249, 0.302005947, 0.303467959, 0.304929256, 0.306389779, 0.307849646, 0.309308767, 0.310767144, 0.312224805, 0.313681751, 0.315137923, 0.316593379, 0.318048060, 0.319502026, 0.320955247, 0.322407693, 0.323859364, 0.325310290, 0.326760441, 0.328209847, 0.329658449, 0.331106305, 0.332553387, 0.333999664, 0.335445136, 0.336889833, 0.338333756, 0.339776874, 0.341219217, 0.342660725, 0.344101429, 0.345541298, 0.346980393, 0.348418683, 0.349856138, 0.351292759, 0.352728575, 0.354163527, 0.355597645, 0.357030958, 0.358463407, 0.359895051, 0.361325800, 0.362755746, 0.364184797, 0.365612984, 0.367040336, 0.368466824, 0.369892448, 0.371317208, 0.372741073, 0.374164075, 0.375586182, 0.377007395, 0.378427744, 0.379847199, 0.381265789, 0.382683456, 0.384100169, 0.385516047, 0.386931002, 0.388345033, 0.389758170, 0.391170382, 0.392581671, 0.393992037, 0.395401478, 0.396809995, 0.398217559, 0.399624199, 0.401029915, 0.402434677, 0.403838456, 0.405241311, 0.406643212, 0.408044159, 0.409444153, 0.410843194, 0.412241250, 0.413638294, 0.415034413, 0.416429549, 0.417823702, 0.419216901, 0.420609087, 0.422000289, 0.423390478, 0.424779683, 0.426167876, 0.427555084, 0.428941309, 0.430326492, 0.431710660, 0.433093816, 0.434475958, 0.435857087, 0.437237173, 0.438616246, 0.439994276, 0.441371292, 0.442747205, 0.444122136, 0.445496023, 0.446868837, 0.448240608, 0.449611336, 0.450980991, 0.452349573, 0.453717113, 0.455083579, 0.456448972, 0.457813323, 0.459176570, 0.460538685, 0.461899787, 0.463259786, 0.464618683, 0.465976506, 0.467333227, 0.468688846, 0.470043331, 0.471396714, 0.472749025, 0.474100202, 0.475450277, 0.476799250, 0.478147060, 0.479493737, 0.480839312, 0.482183754, 0.483527094, 0.484869242, 0.486210287, 0.487550169, 0.488888919, 0.490226507, 0.491562933, 0.492898166, 0.494232297, 0.495565236, 0.496897042, 0.498227656, 0.499557108, 0.500885367, 0.502212465, 0.503538370, 0.504863143, 0.506186664, 0.507508993, 0.508830190, 0.510150135, 0.511468828, 0.512786388, 0.514102757, 0.515417874, 0.516731799, 0.518044472, 0.519356012, 0.520666242, 0.521975279, 0.523283124, 0.524589717, 0.525895059, 0.527199149, 0.528502047, 0.529803574, 0.531103969, 0.532403111, 0.533701003, 0.534997642, 0.536292970, 0.537587106, 0.538879931, 0.540171504, 0.541461766, 0.542750776, 0.544038534, 0.545324981, 0.546610117, 0.547894061, 0.549176633, 0.550457954, 0.551737964, 0.553016722, 0.554294109, 0.555570245, 0.556845069, 0.558118522, 0.559390724, 0.560661614, 0.561931133, 0.563199341, 0.564466238, 0.565731764, 0.566996038, 0.568258941, 0.569520533, 0.570780754, 0.572039604, 0.573297143, 0.574553370, 0.575808227, 0.577061713, 0.578313828, 0.579564571, 0.580814004, 0.582061946, 0.583308637, 0.584553957, 0.585797846, 0.587040365, 0.588281572, 0.589521289, 0.590759695, 0.591996729, 0.593232334, 0.594466507, 0.595699310, 0.596930742, 0.598160684, 0.599389255, 0.600616455, 0.601842225, 0.603066564, 0.604289532, 0.605511010, 0.606731117, 0.607949793, 0.609167039, 0.610382795, 0.611597180, 0.612810075, 0.614021599, 0.615231574, 0.616440177, 0.617647290, 0.618852973, 0.620057225, 0.621259987, 0.622461259, 0.623661101, 0.624859512, 0.626056373, 0.627251804, 0.628445804, 0.629638255, 0.630829275, 0.632018745, 0.633206725, 0.634393275, 0.635578334, 0.636761844, 0.637943923, 0.639124453, 0.640303493, 0.641481042, 0.642657042, 0.643831551, 0.645004570, 0.646176040, 0.647346020, 0.648514390, 0.649681270, 0.650846660, 0.652010500, 0.653172851, 0.654333591, 0.655492842, 0.656650543, 0.657806695, 0.658961296, 0.660114348, 0.661265850, 0.662415802, 0.663564146, 0.664710939, 0.665856242, 0.666999936, 0.668142021, 0.669282556, 0.670421541, 0.671558976, 0.672694802, 0.673829019, 0.674961686, 0.676092744, 0.677222192, 0.678350091, 0.679476321, 0.680601001, 0.681724072, 0.682845533, 0.683965385, 0.685083687, 0.686200321, 0.687315345, 0.688428760, 0.689540565, 0.690650702, 0.691759288, 0.692866206, 0.693971455, 0.695075095, 0.696177125, 0.697277486, 0.698376238, 0.699473321, 0.700568795, 0.701662600, 0.702754736, 0.703845263, 0.704934061, 0.706021249, 0.707106769, 0.708190680, 0.709272802, 0.710353315, 0.711432159, 0.712509334, 0.713584840, 0.714658678, 0.715730846, 0.716801286, 0.717870057, 0.718937159, 0.720002532, 0.721066236, 0.722128212, 0.723188519, 0.724247038, 0.725303948, 0.726359129, 0.727412641, 0.728464365, 0.729514420, 0.730562747, 0.731609404, 0.732654274, 0.733697474, 0.734738886, 0.735778630, 0.736816585, 0.737852812, 0.738887310, 0.739920080, 0.740951121, 0.741980374, 0.743007958, 0.744033754, 0.745057762, 0.746080101, 0.747100592, 0.748119414, 0.749136388, 0.750151634, 0.751165152, 0.752176821, 0.753186762, 0.754194975, 0.755201340, 0.756205976, 0.757208824, 0.758209884, 0.759209216, 0.760206699, 0.761202395, 0.762196302, 0.763188422, 0.764178753, 0.765167296, 0.766153991, 0.767138898, 0.768122017, 0.769103348, 0.770082831, 0.771060526, 0.772036374, 0.773010433, 0.773982704, 0.774953127, 0.775921702, 0.776888490, 0.777853429, 0.778816521, 0.779777765, 0.780737221, 0.781694829, 0.782650590, 0.783604503, 0.784556568, 0.785506845, 0.786455214, 0.787401736, 0.788346410, 0.789289236, 0.790230215, 0.791169345, 0.792106569, 0.793041945, 0.793975472, 0.794907093, 0.795836926, 0.796764791, 0.797690868, 0.798614979, 0.799537301, 0.800457656, 0.801376164, 0.802292824, 0.803207517, 0.804120421, 0.805031300, 0.805940390, 0.806847513, 0.807752788, 0.808656156, 0.809557617, 0.810457170, 0.811354876, 0.812250614, 0.813144445, 0.814036310, 0.814926326, 0.815814435, 0.816700578, 0.817584813, 0.818467140, 0.819347501, 0.820225954, 0.821102500, 0.821977139, 0.822849810, 0.823720515, 0.824589312, 0.825456142, 0.826321065, 0.827184021, 0.828045070, 0.828904152, 0.829761207, 0.830616415, 0.831469595, 0.832320869, 0.833170176, 0.834017515, 0.834862888, 0.835706294, 0.836547732, 0.837387204, 0.838224709, 0.839060247, 0.839893818, 0.840725362, 0.841554940, 0.842382610, 0.843208253, 0.844031870, 0.844853580, 0.845673263, 0.846490920, 0.847306669, 0.848120332, 0.848932087, 0.849741757, 0.850549519, 0.851355195, 0.852158904, 0.852960646, 0.853760302, 0.854557991, 0.855353713, 0.856147349, 0.856939018, 0.857728601, 0.858516216, 0.859301805, 0.860085368, 0.860866904, 0.861646414, 0.862423956, 0.863199413, 0.863972843, 0.864744246, 0.865513623, 0.866280973, 0.867046237, 0.867809474, 0.868570685, 0.869329870, 0.870086968, 0.870842099, 0.871595085, 0.872346044, 0.873094976, 0.873841882, 0.874586642, 0.875329435, 0.876070142, 0.876808763, 0.877545297, 0.878279746, 0.879012227, 0.879742563, 0.880470872, 0.881197095, 0.881921232, 0.882643342, 0.883363307, 0.884081244, 0.884797096, 0.885510862, 0.886222541, 0.886932135, 0.887639642, 0.888345063, 0.889048338, 0.889749587, 0.890448749, 0.891145766, 0.891840696, 0.892533541, 0.893224299, 0.893912971, 0.894599497, 0.895283937, 0.895966291, 0.896646500, 0.897324622, 0.898000538, 0.898674428, 0.899346232, 0.900015891, 0.900683403, 0.901348829, 0.902012110, 0.902673304, 0.903332353, 0.903989315, 0.904644072, 0.905296743, 0.905947268, 0.906595707, 0.907242000, 0.907886147, 0.908528149, 0.909168005, 0.909805715, 0.910441279, 0.911074758, 0.911706030, 0.912335217, 0.912962198, 0.913587093, 0.914209783, 0.914830327, 0.915448666, 0.916064918, 0.916679025, 0.917290986, 0.917900741, 0.918508351, 0.919113815, 0.919717133, 0.920318246, 0.920917213, 0.921514034, 0.922108650, 0.922701120, 0.923291445, 0.923879504, 0.924465477, 0.925049245, 0.925630808, 0.926210225, 0.926787496, 0.927362561, 0.927935421, 0.928506076, 0.929074585, 0.929640889, 0.930205047, 0.930767000, 0.931326747, 0.931884229, 0.932439625, 0.932992756, 0.933543742, 0.934092522, 0.934639096, 0.935183525, 0.935725689, 0.936265647, 0.936803460, 0.937339008, 0.937872350, 0.938403547, 0.938932478, 0.939459205, 0.939983785, 0.940506101, 0.941026211, 0.941544056, 0.942059755, 0.942573190, 0.943084478, 0.943593442, 0.944100261, 0.944604874, 0.945107222, 0.945607364, 0.946105242, 0.946600914, 0.947094321, 0.947585583, 0.948074579, 0.948561311, 0.949045897, 0.949528158, 0.950008214, 0.950486064, 0.950961649, 0.951435030, 0.951906145, 0.952374995, 0.952841640, 0.953306019, 0.953768194, 0.954228103, 0.954685748, 0.955141187, 0.955594361, 0.956045270, 0.956493914, 0.956940353, 0.957384527, 0.957826436, 0.958266079, 0.958703458, 0.959138632, 0.959571481, 0.960002124, 0.960430503, 0.960856616, 0.961280465, 0.961702049, 0.962121427, 0.962538481, 0.962953269, 0.963365793, 0.963776052, 0.964184046, 0.964589775, 0.964993238, 0.965394437, 0.965793371, 0.966189981, 0.966584384, 0.966976464, 0.967366278, 0.967753828, 0.968139112, 0.968522131, 0.968902826, 0.969281256, 0.969657421, 0.970031261, 0.970402837, 0.970772147, 0.971139133, 0.971503854, 0.971866310, 0.972226501, 0.972584367, 0.972939968, 0.973293245, 0.973644257, 0.973992944, 0.974339366, 0.974683523, 0.975025356, 0.975364864, 0.975702107, 0.976037085, 0.976369739, 0.976700068, 0.977028131, 0.977353930, 0.977677345, 0.977998495, 0.978317380, 0.978633940, 0.978948176, 0.979260087, 0.979569733, 0.979877114, 0.980182111, 0.980484843, 0.980785251, 0.981083393, 0.981379211, 0.981672704, 0.981963873, 0.982252717, 0.982539296, 0.982823551, 0.983105481, 0.983385086, 0.983662426, 0.983937442, 0.984210074, 0.984480441, 0.984748483, 0.985014260, 0.985277653, 0.985538721, 0.985797524, 0.986053944, 0.986308098, 0.986559927, 0.986809433, 0.987056553, 0.987301409, 0.987543941, 0.987784147, 0.988022029, 0.988257587, 0.988490760, 0.988721669, 0.988950253, 0.989176512, 0.989400446, 0.989621997, 0.989841282, 0.990058184, 0.990272820, 0.990485072, 0.990695000, 0.990902662, 0.991107941, 0.991310835, 0.991511464, 0.991709769, 0.991905689, 0.992099345, 0.992290616, 0.992479563, 0.992666125, 0.992850423, 0.993032336, 0.993211925, 0.993389189, 0.993564129, 0.993736744, 0.993906975, 0.994074881, 0.994240463, 0.994403660, 0.994564593, 0.994723141, 0.994879305, 0.995033205, 0.995184720, 0.995333910, 0.995480776, 0.995625257, 0.995767415, 0.995907247, 0.996044695, 0.996179819, 0.996312618, 0.996443033, 0.996571124, 0.996696889, 0.996820331, 0.996941328, 0.997060061, 0.997176409, 0.997290432, 0.997402132, 0.997511446, 0.997618437, 0.997723043, 0.997825325, 0.997925282, 0.998022854, 0.998118103, 0.998211026, 0.998301566, 0.998389721, 0.998475552, 0.998559058, 0.998640239, 0.998719037, 0.998795450, 0.998869538, 0.998941302, 0.999010682, 0.999077737, 0.999142408, 0.999204755, 0.999264777, 0.999322414, 0.999377668, 0.999430597, 0.999481201, 0.999529421, 0.999575317, 0.999618828, 0.999660015, 0.999698818, 0.999735296, 0.999769390, 0.999801159, 0.999830604, 0.999857664, 0.999882340, 0.999904692, 0.999924719, 0.999942362, 0.999957621, 0.999970615, 0.999981165, 0.999989390, 0.999995291, 0.999998808, 1.000000000};

    const LUTFunction<float> fast_sin(
        0.0f, 0.5f * consts::pi, sin_first_quadrant,
        sizeof(sin_first_quadrant) / sizeof(sin_first_quadrant[0]),
        sin_periodicity);
    const LUTFunction<float> fast_cos(
        -0.5f * consts::pi, 0.0f, sin_first_quadrant,
        sizeof(sin_first_quadrant) / sizeof(sin_first_quadrant[0]),
        sin_periodicity);

  } // namespace math
} // namespace motor_driver
